$(document).ready(function(){function t(){$(".f").hasClass("unit-active")?t="<span style='font-size:.3em;font-weight:400'> mph</span>":$(".c").hasClass("unit-active")&&(t="<span style='font-size:.3em;font-weight:400'> kmh</span>")}function e(t){$(".yesterday-content").children("*").remove(),$(".tide-content").children("*").remove(),$(".bot-content").children("*").remove(),$(".hourly-content").children("*").remove(),$("."+t+"-content").css({visibility:"visible"})}function a(t){var e=$('<li class="ftr"  id="ftr'+t+'"></li>'),i=$('<div class="city-title" id="city'+t+'"></div>'),a=$('<div class="tempr" id="tempr'+t+'"></div>'),n=$('<div class="minx" id="min'+t+'"></div>'),c=$('<div class="minCond" id="minCond'+t+'"></div>'),o=$('<img class="imgSrc" id="imgSrc'+t+'">'),d=$('<div class="save-close" id="close'+t+'">Close</div>');console.log(t),$(".right").append(e),e.append(i),e.append(a),e.append(n),e.append(o),e.append(c),e.append(d),$(".ftr").each(function(){$(this).on("click",function(){s=$(this).children(".city-title").html(),$(".search-text").val(s),$(".search").trigger("click")})}),$(".save-close").each(function(t){$(this).on("click",function(){$(this).parent(".ftr").remove()}),$(this).attr("id","ftr"+(t+1))})}function n(){$(".search-text").autocomplete({source:function(t,e){$.ajax({url:"http://gd.geobytes.com/AutoCompleteCity?callback=?&q="+t.term,dataType:"jsonp",async:!1,type:"GET",crossDomain:!0,success:function(t){e(t)}})},minLength:2,select:function(t,e){var i=e.item,a=/,\s\w+,/gi,n=i.value.replace(a,",");s=n;var c=/^(\w+\s\w+,\s)|\w+,\s/g,o=i.value.replace(c,"");return countryList="child/data/country.json",$.ajax({url:countryList,type:"GET",dataType:"json",async:!1,success:function(){}}),$(".search-text").val("United States"==o?i.value.replace(", United States",""):n),$(".bot-content").children("*").remove(),$(".hourly-content").children("*").remove(),$(".hourly-content").css({visibility:"visible"}),$(".yesterday-content").children("*").remove(),$(".tide-content").children("*").remove(),$(".search").trigger("click"),!1}})}var s,t,c="<span style='font-weight:200;font-size:.3em;'> %</span>";if(localStorage.length>0){var o=JSON.parse(localStorage.getItem("cityArr")).length,d=JSON.parse(localStorage.getItem("cityArr"));for(i=1;o>=i;i++)a(i),$("#city"+i).html(d[i-1].city),$("#tempr"+i).html(d[i-1].temp),$("#min"+i).html(d[i-1].minx),$("#minCond"+i).html(d[i-1].minCond),$("#imgSrc"+i).attr("src",d[i-1].imgSrc);$(".saving-clear").on("click",function(){localStorage.clear(),$(".right").children("*").remove()})}$("form").keydown(function(t){"13"==t.which&&($(".bot-content").children("*").remove(),$(".hourly-content").children("*").remove(),$(".yesterday-content").children("*").remove(),$(".tide-content").children("*").remove(),$(".search").trigger("click"))}),$(".search-text").keyup(function(t){27==t.which&&$(this).val("")}),$(".closeBtn").on("click",function(){$(".search-text").val(""),$(".search-text").focus()}),$(".search-text").on("click",function(){$(this).select()});var r=$(window).height(),l=$(window).width();320==l&&480==r?($("body").append("<div class='toolbar'></div>"),$(".toolbar").append("<div class='favorite'>Favorite</div>"),$(".right").append("<div class='clear320'>Clear</div>")):($(".saveFavorite").remove(),$(".clear320").remove()),$(".favorite").on("click",function(){$(".favorite").toggleClass("favorite-active"),$(".right").toggleClass("right-active")});var p="http://freegeoip.net/json/";$.ajax({url:p,type:"GET",dataType:"jsonp",success:function(t){return s=t.city,state=t.region_code,$(".search-text").val(s+", "+state),$(".search").trigger("click"),state}});$(".search").click(function(){function a(){return $.ajax({type:"GET",url:p,async:!1,dataType:"json",success:function(){}})}function n(){return $.ajax({type:"GET",url:h,async:!1,dataType:"json",success:function(){}})}function o(){return $.ajax({type:"GET",url:m,async:!1,dataType:"json",success:function(){}})}function d(){return $.ajax({type:"GET",url:y,async:!1,dataType:"json",success:function(){}})}$(".saving-clear").on("click",function(){localStorage.clear(),$(".right").children("*").remove()}),$(".clear320").on("click",function(){localStorage.clear(),$(".right").children(".ftr").remove()}),$(".yesterday-content").children("*").remove(),$(".tide-content").children("*").remove(),$(".bot-content").children("*").remove(),$(".hourly-content").children("*").remove(),$(".hourly-content").css({visibility:"visible"}),s=$(".search-text").val(),s=s.toLowerCase().replace(/\b[a-z]/g,function(t){return t.toUpperCase(/\$/gi)});var r=s.replace(/,\s\w+/g,""),l=s.replace(/\w+,\s/g,""),p="child/data/lynnwood.json",h="child/data/San_Francisco.json",m="child/data/yesterday.json",y="child/data/tide.json";$.when(a(),n(),o(),d()).then(function(a,n,s,o){function d(t,e){if(e.indexOf("cloudy")>-1)$(t).attr("src","child/img/svg/cloudy.svg").css("opacity","1");else if(e.indexOf("rain")>-1)$(t).attr("src","child/img/svg/rain.svg").css("opacity","1");else if(e.indexOf("shower")>-1)$(t).attr("src","child/img/svg/rain.svg").css("opacity","1");else if(e.indexOf("snow")>-1)$(t).attr("src","child/img/svg/snow.svg").css("opacity","1");else if(e.indexOf("partlycloudy")>-1)$(t).attr("src","child/img/svg/partly-cloudy.png").css("opacity",".2");else if(e.indexOf("tstorms")>-1)$(t).attr("src","child/img/svg/tstorm.svg").css("opacity","1");else if(e.indexOf("sun")>-1)$(t).attr("src","child/img/png/sun.png").css("opacity","1");else if(e.indexOf("clear")>-1){var i=new Date,a=i.getHours();a>20&&a>24&&7>a?$(t).attr("src","child/img/svg/moon.svg").css("opacity","1"):$(t).attr("src","child/img/png/sun.png").css("opacity","1")}else console.log("design icon later")}function p(){for(x=0;10>=x;x++)P[x]=T[x].FCTTIME.civil,$(".f").hasClass("unit-active")?(O[x]=T[x].temp.english,I[x]=T[x].dewpoint.english,G[x]=T[x].wspd.english):$(".c").hasClass("unit-active")&&(O[x]=T[x].temp.metric,I[x]=T[x].dewpoint.metric,G[x]=T[x].wspd.metric),_[x]=T[x].wx,H[x]=T[x].icon,E[x]=T[x].humidity,W[x]=parseInt(T[x].pop),O.push(O[x]),I.push(I[x]),_.push(_[x]),G.push(G[x]),E.push(E[x]),W.push(W[x]);for(i=1;10>=i;i++)$(".hourly-content").append("<li class='hourly-item' id='hourly-item"+i+"'></li>"),$("#hourly-item"+i).append("<p class='hourly-clock' id='hourly-clock"+i+"'></p>"),$("#hourly-item"+i).append("<p class='hourly-max' id='hourly-max"+i+"'></p>"),$("#hourly-item"+i).append("<p class='hourly-min' id='hourly-min"+i+"'></p>"),$("#hourly-item"+i).append("<div class='hourly-cond' id='hourly-cond"+i+"'></div>"),$("#hourly-cond"+i).append("<img class='hourly-cond-img' id='hourly-cond-img"+i+"'>"),$("#hourly-cond"+i).append("<p class='hourly-cond-text' id='hourly-cond-text"+i+"' ></p>"),$("#hourly-item"+i).append("<p class='hourly-wind' id='hourly-wind"+i+"' ></p>"),$("#hourly-item"+i).append("<p class='hourly-humidity' id='hourly-humidity"+i+"' ></p>"),$("#hourly-item"+i).append("<p class='hourly-pop' id='hourly-pop"+i+"' ></p>")}function h(){for(p(),i=1;10>=i;i++)$("#hourly-clock"+i).text(P[i-1]),$("#hourly-max"+i).text(O[i-1]),$("#hourly-min"+i).text(I[i-1]),d("#hourly-cond-img"+i,H[i-1]),$("#hourly-cond-text"+i).text(_[i-1]),$("#hourly-wind"+i).html("w: "+G[i-1]+t),$("#hourly-humidity"+i).html("h: "+E[i-1]+c),$("#hourly-pop"+i).html("p: "+W[i-1]+c)}function m(t,e,i){$("."+t+"-content").append("<li class='n-day' id='n"+e+"d' data-weekdays='"+i+"'></li>"),$("#n"+e+"d").append("<div class='n-day-date' id='n-day-date"+e+"'></div>"),$("#n"+e+"d").append("<div class='name-n-day' id='name-d"+e+"'></div>"),$("#n"+e+"d").append("<div class='n-day-max' id='n"+e+"dMax'></div>"),$("#n"+e+"d").append("<div class='n-day-min' id='n"+e+"dMin'></div>"),$("#n"+e+"d").append("<img class='n-day-cond-img' id='n"+e+"dCondImg'>"),$("#n"+e+"d").append("<div class='n-day-cond' id='n"+e+"dCond'></div>"),$("#n"+e+"d").append("<div class='n-day-wind' id='n"+e+"dWind'></div>"),$("#n"+e+"d").append("<div class='n-day-humidity' id='n"+e+"dHumidity'></div>"),$("#n"+e+"d").append("<div class='n-day-pop' id='n"+e+"dPop'></div>")}function y(t){for(i=1;t>=i;i++){if(m("bot",i,tempNextDayName[i]),$("#n-day-date"+i).html(tempNextDayDate[i]),$("#name-d"+i).html(tempNextDayName[i]),$("#n"+i+"dMax").html(tempNextDayMax[i]),$("#n"+i+"dMin").html(tempNextDayMin[i]),tempNextDayCond[i-1].indexOf("Showers")){var e,a=/(\w+)\s(\w+)/gi;e=tempNextDayCond[i-1].replace(a,function(){}),e=tempNextDayCond[i-1].replace(a,"$1 <span class='property'>$2</span>")}var n;$(".f").hasClass("unit-active")?n="<span class='wind-unit'> mph</span>":$(".c").hasClass("unit-active")&&(n="<span class='wind-unit'> kmh</span>"),$("#n"+i+"dCond").html(e),d("#n"+i+"dCondImg",C),$("#n"+i+"dPop").html("p: "+tempNextDayPop[i-1]+c),$("#n"+i+"dWind").html("w: "+tempNextDayWind[i-1]+n),$("#n"+i+"dHumidity").html("h: "+tempNextDayHumidity[i-1]+c)}$(".n-day").each(function(){$(this).on("click",function(){var t=$(this).data("weekdays");console.log("weekday: "+t)})})}function u(){var t=["Friday","Saturday","Sunday"];$(".n-day").each(function(){for(i in t)$(this).data("weekdays")==t[i]&&$(this).addClass("weekend")})}function f(){var t=s[0].history,e=t.date.pretty;if($(".f").hasClass("unit-active"))var a=Math.round(t.observations[0].tempi),n=Math.round(t.observations[0].dewpti),o=Math.round(t.observations[0].wspdi);else if($(".c").hasClass("unit-active"))var a=Math.round(t.observations[0].tempm),n=Math.round(t.observations[0].dewptm),o=Math.round(t.observations[0].wspdm);var r,l=t.observations[0].conds,p=(t.observations[0].icon,t.observations[0].hum),h=t.observations[0].rain,y=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],u=g.forecastday[0].date.weekday;for(i in y)u==y[i]?r=y[i-1]:"Sunday"==u&&(r="Saturday");m("yesterday",1,r),$("#n-day-date1").html(e),$("#name-d1").html(r),$("#n1dMax").html(a),$("#n1dMin").html(n),d("#n1dCondImg",C),$("#n1dCond").text(l);var f;$(".f").hasClass("unit-active")?f="<span class='wind-unit'> mph</span>":$(".c").hasClass("unit-active")&&(f="<span class='wind-unit'> kmh</span>"),$("#n1dWind").html(o+f),$("#n1dHumidity").html(p+c),$("#n1dPop").html(h+c)}function v(){var t=o[0].tide.tideSummaryStats[0],e=Math.round(t.maxheight,2),a=Math.round(t.minheight,2),n=o[0].tide.tideSummary;for($(".tide-content").append("<li class='summary'></li>"),$(".summary").append("<span class='sumHigh'>High: "+e+"</span>"),$(".summary").append("<span class='sumLow'>Low: "+a+"</span>"),f=1;5>=f;f++)$(".summary").append("<span class='select-date' id='select-date"+f+"' data-date='"+f+"'></span>");$(".select-date").each(function(){var t=$(this).data("date");$("#select-date"+t).on("click",function(){$(".tide-item"+t).css({visibility:"visible"}),$(".tide-content").animate({scrollTop:225*(t-1)},"500","swing",function(){})})});var s=n.length,c=[],d=[],r=[],l=[],p=[],h=[],m=[],y=[];for($(".tide-content").append("<ul class='details'></ul>"),i=0;s>=i;i++){d[i]=n[i].data.height,r[i]=n[i].data.type,l[i]=n[i].date.hour,p[i]=n[i].date.min,h[i]=n[i].date.mday,m[i]=n[i].date.mon,y[i]=n[i].date.year,c.push(c[i]),d.push(d[i]),r.push(r[i]),l.push(l[i]),p.push(p[i]),h.push(h[i]),m.push(m[i]),y.push(y[i]),""==d[i]&&(d[i]="n/a");var u=["January","Febuary","March","April","May","June","July","August","September","October","November","December"];m[i]=parseInt(m[i]),m[i]=u[m[i]-1],console.log("tidemonth: "+m[1]);var f=0;h[i]-h[0]==0?(f=1,$(".details").append("<li  id='tide-item"+(i+1)+"' class='tide-item"+f+"'></li>"),$("#select-date"+f).html(h[i]),$("#select-date"+f).data("date",h[i])):h[i]-h[0]==1?(f=2,$(".details").append("<li  id='tide-item"+(i+1)+"' class='tide-item"+f+"'></li>"),$("#select-date"+f).html(h[i]),$("#select-date"+f).data("date",h[i])):h[i]-h[0]==2?(f=3,$(".details").append("<li  id='tide-item"+(i+1)+"' class='tide-item"+f+"'></li>"),$("#select-date"+f).html(h[i]),$("#select-date"+f).data("date",h[i])):h[i]-h[0]==3?(f=4,$(".details").append("<li  id='tide-item"+(i+1)+"' class='tide-item"+f+"'></li>"),$("#select-date"+f).html(h[i]),$("#select-date"+f).data("date",h[i])):h[i]-h[0]==4&&(f=5,$(".details").append("<li  id='tide-item"+(i+1)+"' class='tide-item"+f+"'></li>"),$("#select-date"+f).html(h[i]),$("#select-date"+f).data("date",h[i])),$("#tide-item"+(i+1)).append("<div class='tide-item-time'></div>"),$("#tide-item"+(i+1)).append("<div class='tide-item-high'></div>"),$("#tide-item"+(i+1)).append("<div class='tide-item-type'></div>"),$("#tide-item"+(i+1)+" .tide-item-time").html(l[i]+":"+p[i]+" "+m[i]+" "+h[i]+", "+y[i]),$("#tide-item"+(i+1)+" .tide-item-high").html(d[i]),$("#tide-item"+(i+1)+" .tide-item-type").html(r[i])}}$(".unit").each(function(){$(this).on("click",function(){$(".unit").removeClass("unit-active"),$(this).addClass("unit-active"),$(".search").trigger("click"),$(".bot-content").children("*").remove(),$(".hourly-content").children("*").remove(),$(".yesterday-content").children("*").remove(),$(".tide-content").children("*").remove();$(".forecast-switch").data("switch");$(".five-switch").hasClass("forecast-active")&&y(5),$(".ten-switch").hasClass("forecast-active")&&y(10),$(".weekend-switch").hasClass("forecast-active")?(y(10),u()):$(".yesterday-switch").hasClass("forecast-active")?f():$(".hourly-switch").hasClass("forecast-active")&&h()})});var g=a[0].forecast.simpleforecast,w=g.forecastday[0].avehumidity,k=g.forecastday[0].conditions,C=g.forecastday[0].icon,N=g.forecastday[0].pop,b=g.forecastday[0].date.weekday,D=g.forecastday[0].date.day,S=g.forecastday[0].date.monthname,M=g.forecastday[0].date.year,j="https://api.flickr.com/services/rest/?method=flickr.favorites.getPublicList&user_id=33416734@N03&api_key=7e519d7b080dcfc36ddfb22eff037a0a&text="+r+" "+l+"&machine_tags=fav:title&safe_search=1&format=json&jsoncallback=?";for($.ajax({type:"GET",url:j,dataType:"jsonp",success:function(t){var e=(t.photos.photo.length,t.photos.photo);for(i in e)if(-1!==e[i].title.indexOf(r)){$(".bgimg").attr("src",""),flickrID=e[i].id,flickrOwner=e[i].owner,flickrSecret=e[i].secret,flickrServer=e[i].server,flickrFarm=e[i].farm,console.log(flickrOwner);var a="https://api.flickr.com/services/rest/?method=flickr.people.getInfo&user_id="+flickrOwner+"&api_key=7e519d7b080dcfc36ddfb22eff037a0a&safe_search=1&format=json&jsoncallback=?";$.ajax({type:"GET",url:a,dataType:"jsonp",success:function(t){console.log(t),console.log(t.person.username._content),$(".flink").html(t.person.username._content)}}),flickrIMG="https://farm"+flickrFarm+".static.flickr.com/"+flickrServer+"/"+flickrID+"_"+flickrSecret+"_z.jpg",flickrOwnerURL="https://flickr.com/photos/"+flickrOwner+"/"+flickrID+"/",$(".photourl").attr("href",flickrOwnerURL),$(".background").css("background-image","url("+flickrIMG+")")}}}),D+="1"==D||"01"==D||"21"==D||"31"==D?"<span><sup>st</sup></span>":"2"==D||"22"==D||"02"==D?"<span><sup>nd</sup></span>":"3"==D||"03"==D||"23"==D?"<span><sup>rd</sup></span>":"<span><sup>th</sup></span>",$(".date").html(b+", "+S+" "+D+", "+M),$(".f").hasClass("unit-active")?(max=g.forecastday[0].high.fahrenheit,min=g.forecastday[0].low.fahrenheit,wind=g.forecastday[0].maxwind.mph,t="<span style='font-size:.3em;font-weight:400'> mph</span>"):$(".c").hasClass("unit-active")&&(max=g.forecastday[0].high.celsius,min=g.forecastday[0].low.celsius,wind=g.forecastday[0].maxwind.kph,t="<span style='font-size:.3em;font-weight:400'> kmh</span>"),$(".condition").html(k),$(".tempr-content").html(max),$(".min").html(min),$(".wind").html("<div class='wind-text' style='font-weight:400'><span style='font-weight:800'>W</span>ind </div><p class='wind-value'><span class='wind-number'>"+wind+"</span>"+t+"</p>"),$(".humidity").html("<div class='wind-text' style='font-weight:400'><span style='font-weight:800'>H</span>umidity </div><div class='wind-value'><span class='wind-number'>"+w+"</span>"+c+"</div>"),$(".pop").html("<p class='wind-text' style='font-weight:400'><span style='font-weight:800'>P</span>rocipitation </p><p class='wind-value'><span class='wind-number'>"+N+"</span>"+c+"</p>"),tempNextDayName=[],tempNextDayDate=[],tempNextDayMax=[],tempNextDayMin=[],tempNextDayCond=[],tempNextDayWind=[],tempNextDayHumidity=[],tempNextDayPop=[],x=0;9>=x;x++)tempNextDayDate[x]=g.forecastday[x].date.pretty.replace(/^\d+:\d+\s\w+\s\w+\s\w+\s/g,"").replace(/,\s\d+/g,""),tempNextDayName[x]=g.forecastday[x].date.weekday,$(".f").hasClass("unit-active")?(tempNextDayMax[x]=g.forecastday[x].high.fahrenheit,tempNextDayMin[x]=g.forecastday[x].low.fahrenheit):$(".c").hasClass("unit-active")&&(tempNextDayMax[x]=g.forecastday[x].high.celsius,tempNextDayMin[x]=g.forecastday[x].low.celsius),tempNextDayCond[x]=g.forecastday[x].conditions,tempNextDayPop[x]=g.forecastday[x].pop,tempNextDayWind[x]=g.forecastday[x].maxwind.mph,tempNextDayHumidity[x]=g.forecastday[x].avehumidity,tempNextDayDate.push(tempNextDayDate[x]),tempNextDayName.push(tempNextDayName[x]),tempNextDayMax.push(tempNextDayMax[x]),tempNextDayMin.push(tempNextDayMax[x]),tempNextDayCond.push(tempNextDayCond[x]),tempNextDayPop.push(tempNextDayPop[x]),tempNextDayWind.push(tempNextDayWind[x]),tempNextDayHumidity.push(tempNextDayHumidity[x]);d(".condition-icon",C);var T=n[0].hourly_forecast,O=[],I=[],_=[],H=[],G=[],E=[],P=[],W=[];h(),$(".bot-content").children("*").remove(),$(".forecast-switch").on("click",function(){function t(t){$("."+t+"-content").children("*").remove(),$("."+t+"-content").css({visibility:"visible"})}$(".forecast-switch").removeClass("forecast-active"),$(this).addClass("forecast-active");var i=$(this).data("switch"),a=$(this).data("days");t(i),"bot"==i?(e(i),y(a)):"yesterday"==i?(e(i),f()):"hourly"==i?(e(i),h()):"weekend"==i?($(".hourly-content").children("*").remove(),$(".tide-content").children("*").remove(),$(".yesterday-content").children("*").remove(),$(".bot-content").children("*").remove(),$(".bot-content").css({visibility:"visible"}),y(9),u()):"tide"==i&&(e(i),v())})})}),$(".save").on("click",function(){var t=[];if(localStorage.length>0){var e=JSON.parse(localStorage.getItem("cityArr")).length;ftrCount=e;var n=JSON.parse(localStorage.getItem("cityArr"));for(i=0;i<=n.length-1;i++)t.push(n[i]);$(".saving-clear").on("click",function(){$(".right").hasClass("hideSaved")?$(".right").removeClass("hideSaved"):$(".right").addClass("hideSaved"),localStorage.clear(),$(".right").children("*").remove()})}else ftrCount=0;if(ftrCount++,9===ftrCount)return!1;if(cityText=$(".search-text").val(),a(ftrCount),9===ftrCount)return!1;{var s=parseInt($(".tempr-content").html()),c=parseInt($(".min").html()),o=$(".condition").html(),d=$(".condition-icon").attr("src");$(".condition").html()}t.push({city:cityText,temp:s,minx:c,minCond:o,imgSrc:d}),localStorage.setItem("cityArr",JSON.stringify(t));var e=JSON.parse(localStorage.getItem("cityArr"));$("#city"+ftrCount).html(e[ftrCount-1].city),$("#tempr"+ftrCount).html(e[ftrCount-1].temp),$("#min"+ftrCount).html(e[ftrCount-1].minx),$("#imgSrc"+ftrCount).attr("src",d),$("#minCond"+ftrCount).html(e[ftrCount-1].minCond)}),n(),$(".search-text").autocomplete("option","delay",10)});