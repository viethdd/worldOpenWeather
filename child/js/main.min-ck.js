$(document).ready(function(){function f(){function i(e){$(".daynight").css("opacity",e)}var e=new Date,t=e.getHours(),n=e.getMinutes(),r=e.getSeconds();t>18&&t<20&&i(.6);t>20&&t<24&&i(.8);t>0&&t<7&&i(.9);t>7&&t<12&&i(.2);t>12&&t<16&&i(.1);t>16&&t<18&&i(.5)}function p(t){var n=$('<div class="ftr" id="ftr'+t+'"></div>'),r=$('<div class="city-title" id="city'+t+'"></div>'),i=$('<div class="tempr" id="tempr'+t+'"></div>'),s=$('<div class="minx" id="min'+t+'"></div>'),o=$('<div class="minCond" id="minCond'+t+'"></div>');$(".right").append(n);n.append(r);n.append(i);n.append(s);n.append(o);$(".ftr").each(function(){$(this).on("click",function(){e=$(this).children(".city-title").html();$(".search-text").val(e);$(".search").trigger("click")})});$(".clear").css({opacity:"1",cursor:"pointer"})}function d(){$(".search-text").autocomplete({source:function(e,t){$.ajax({url:"http://gd.geobytes.com/AutoCompleteCity?callback=?&q="+e.term,dataType:"jsonp",async:!0,success:function(e){t(e)}})},minLength:3,select:function(t,n){$(".tempr-content").addClass("tempr-content");var r=n.item,i=/,\s\w+,/gi,s=r.value.replace(i,",");e=s;var o=/^(\w+\s\w+,\s)|\w+,\s/g,u=r.value.replace(o,"");if(u=="United States")$(".search-text").val(r.value.replace(", United States",""));else{$(".search-text").val(s);console.log(s)}$(".search").trigger("click");return!1}})}var e,t,n=[],r="imperial";$("form").keydown(function(e){if(e.which=="enter"){$(".search").trigger("click");f()}});$(".search-text").keyup(function(e){e.which==27&&$(this).val("")});if(localStorage.length>0){$(".clear").css({opacity:"1",cursor:"pointer"});var s=JSON.parse(localStorage.getItem("cityArr")).length,o=JSON.parse(localStorage.getItem("cityArr"));for(i=1;i<=s;i++){p(i);$("#city"+i).html(o[i-1].city);$("#tempr"+i).html(o[i-1].temp);$("#min"+i).html(o[i-1].minx);$("#minCond"+i).html(o[i-1].minCond)}$(".clear").on("click",function(){localStorage.clear();$(".right").children("*").remove();$(".clear").css({opacity:".4",cursor:"default"})});$(".clear320").on("click",function(){localStorage.clear();$(".right").children(".ftr").remove();$(".clear320").css({opacity:".4",cursor:"default"})})}else $(".clear").css({opacity:".4",cursor:"default"});$(".closeBtn").on("click",function(){$(".search-text").val("");$(".search-text").focus()});var u=$(window).height(),a=$(window).width();if(a==320&&u==480){$("body").append("<div class='toolbar'></div>");$(".toolbar").append("<div class='favorite'>Favorite</div>");$(".right").append("<div class='clear320'>Clear</div>")}else{$(".saveFavorite").remove();$(".clear320").remove()}$(".favorite").on("click",function(){$(".favorite").toggleClass("favorite-active");$(".right").toggleClass("right-active")});f();var l=[],c=0;$(".c").click(function(){r="metric";$(".c").addClass("active-unit");$(".f").removeClass("active-unit");$(".search").trigger("click");$(".unit-display").html("&deg;C");var e=$(".tempr-content").html(),t=Math.round((e-32)*5/9);$(".tempr-content").html(t);var n=$("#tempr1").html(),i=Math.round((n-32)*5/9);$("#tempr1").html(i);var s=$("#min1").html(),o=Math.round((s-32)*5/9);$("#min1").html(i);var u=$("#tempr2").html(),a=Math.round((u-32)*5/9);$("#tempr2").html(a);var f=$("#min2").html(),l=Math.round((f-32)*5/9);$("#min2").html(a);var c=$("#tempr3").html(),h=Math.round((c-32)*5/9);$("#tempr3").html(h);var p=$("#min3").html(),d=Math.round((p-32)*5/9);$("#min3").html(h);var v=$("#tempr4").html(),m=Math.round((v-32)*5/9);$("#tempr4").html(m);var g=$("#min4").html(),y=Math.round((g-32)*5/9);$("#min4").html(m);var b=$("#tempr5").html(),w=Math.round((b-32)*5/9);$("#tempr5").html(w);var E=$("#min5").html(),S=Math.round((E-32)*5/9);$("#min5").html(w)});$(".f").click(function(){r="imperial";$(".f").addClass("active-unit");$(".c").removeClass("active-unit");$(".unit-display").html("&deg;F");$(".search").trigger("click");var e=$(".tempr-content").html(),t=Math.round(e*9/5-32);$(".tempr-content").html(t);var n=$("#tempr1").html(),i=Math.round(n*9/5+32);$("#tempr1").html(i);var s=$("#min1").html(),o=Math.round(s*9/5+32);$("#min1").html(o);var u=$("#tempr2").html(),a=Math.round(u*9/5+32);$("#tempr2").html(a);var f=$("#min2").html(),l=Math.round(f*9/5+32);$("#min2").html(l);var c=$("#tempr3").html(),h=Math.round(c*9/5+32);$("#tempr3").html(h);var p=$("#min3").html(),d=Math.round(p*9/5+32);$("#min3").html(d);var v=$("#tempr4").html(),m=Math.round(v*9/5+32);$("#tempr4").html(m);var g=$("#min4").html(),y=Math.round(g*9/5+32);$("#min4").html(y);var b=$("#tempr5").html(),w=Math.round(b*9/5+32);$("#tempr5").html(w);var E=$("#min5").html(),S=Math.round(E*9/5+32);$("#min5").html(S)});$(".search-text").on("click",function(){$(this).select()});$.getJSON("http://api.hostip.info/get_json.php",function(t){e=t.city;regionCode=t.region_code;$(".search-text").val(e);$(".search").trigger("click")});$(".search").click(function(t){$(".clear").on("click",function(){localStorage.clear();$(".right").children("*").remove();$(".clear").css({opacity:".4",cursor:"default"})});$(".clear320").on("click",function(){localStorage.clear();$(".right").children(".ftr").remove();$(".clear320").css({opacity:".4",cursor:"default"})});e=$(".search-text").val();e=e.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase(/\$/ig)});$(".city-content").html(e);var n="http://api.wunderground.com/api/3da12bf1311628a6/forecast10day/q/"+e+".json";$.ajax({url:n,dataType:"jsonp",success:function(e){var n=e.forecast.simpleforecast.forecastday[0],r=e.forecast.simpleforecast,s=r.forecastday[0].high.fahrenheit,o=r.forecastday[0].low.fahrenheit,u=r.forecastday[0].maxwind.mph,a=r.forecastday[0].avehumidity,f=r.forecastday[0].conditions,l=r.forecastday[0].icon_url,c=r.forecastday[0].pop,h=r.forecastday[0].low.celsius,p=r.forecastday[0].high.celsius;console.log("clow:  "+h);console.log("chigh:  "+p);if(l.indexOf("rain")>-1){$(".pop").remove();$(".top-content").append("<p class='pop' style='color: white'>"+c+"%</p>");console.log("change "+c+"%")}else $(".pop").remove();$(".condition").html(f);$(".tempr-content").html(s);$(".min").html(o);tempNextDayMax=[];tempNextDayMin=[];tempNextDayCond=[];tempNextDayWind=[];tempNextDayHumidity=[];tempNextDayPressure=[];for(x=0;x<=4;x++){tempNextDayMax[x]=r.forecastday[x].high.fahrenheit;tempNextDayMin[x]=r.forecastday[x].low.fahrenheit;tempNextDayCond[x]=r.forecastday[x].conditions;tempNextDayWind[x]=r.forecastday[x].maxwind.mph;tempNextDayHumidity[x]=r.forecastday[x].avehumidity;tempNextDayMax.push(tempNextDayMax[x]);tempNextDayMin.push(tempNextDayMax[x]);tempNextDayCond.push(tempNextDayCond[x]);tempNextDayWind.push(tempNextDayWind[x]);tempNextDayHumidity.push(tempNextDayHumidity[x])}console.log("tempNextDayMax2: "+tempNextDayMax[1]);console.log("tempNextDayMin2: "+tempNextDayMin[1]);console.log("tempNextDaycond2: "+tempNextDayCond[1]);console.log("tempNextDayMax2: "+tempNextDayWind[1]);l.indexOf("cloud")>-1?$(".condition-icon").attr("src","child/img/weather_cloud-01.png").css("opacity","1"):l.indexOf("rain")>-1?$(".condition-icon").attr("src","child/img/weather_rain.png").css("opacity","1"):l.indexOf("snow")>-1?$(".condition-icon").attr("src","child/img/weather_snow.png").css("opacity","1"):l.indexOf("clear")>-1?$(".condition-icon").attr("src","child/img/weather_cloud-01.png").css("opacity",".2"):console.log("design icon later");var d=$(".search-text").val(),v="http://api.worldweatheronline.com/free/v1/tz.ashx?q="+d+"&format=json&key=j7cf7epyawudqvbkf3cvc7r2";$.ajax({url:v,dataType:"jsonp",success:function(e){function m(e){$(".daynight").css("opacity",e)}var t=e.data.time_zone[0].localtime,n=t.replace(/\d+-\d+-\d+\s/g,""),r=t.replace(/\s\d+:\d\d/g,"").replace("2014-","")+"-2014",s=parseInt(t.replace(/\d+-\d+-\d+\s/g,"").replace(/(:\d+)/g,"")),o=parseInt(r.replace(/-\d+-\d+/g,"")),u,a=parseInt(r.replace("-2014","").replace(/\d+-/g,"")),f=parseInt(r.replace(/\d+-/g,"")),l;if(a==1||a==21||a==31)l="<sup>st</sup>";if(a==2||a==22)l="<sup>nd</sup>";if(a==3||a==23)l="<sup>rd</sup>";a>3&&a<21&&(l="<sup>th</sup>");a>23&&a<31&&(l="<sup>th</sup>");switch(o){case 1:u="Jan.";break;case 2:u="Feb.";break;case 3:u="Mar.";break;case 4:u="Apr.";break;case 5:u="May.";break;case 6:u="Jun.";break;case 7:u="Jul.";break;case 8:u="Aug.";break;case 9:u="Sep.";break;case 10:u="Oct.";break;case 11:u="Nov.";break;default:u="Dec."}var c=new Date;c.setDate(a);var h=c.toDateString(),p=h.replace(/\s\w+/g,"").toString();switch(p){case"Mon":p="Monday";break;case"Tue":p="Tuesday";break;case"Wed":p="Wednesday";break;case"Thu":p="Thursday";break;case"Fri":p="Friday";break;case"Sat":p="Saturday";break;case"Sun":p="Sunday";break;default:}var d=new Date;for(i=1;i<=5;i++){d.setDate(a+i);var v=d.toDateString().replace(/\s\w+/g,"").toString();switch(v){case"Mon":v="Monday";break;case"Tue":v="Tuesday";break;case"Wed":v="Wednesday";break;case"Thu":v="Thursday";break;case"Fri":v="Friday";break;case"Sat":v="Saturday";break;case"Sun":v="Sunday";break;default:}$("#name-d"+i).html(v)}s>12?$(".time").html(n+" PM"):$(".time").html(n+" AM");$(".date").html(p+" "+u+" <span style='font-weight: bold'>"+a+l+"</span> "+f);s>=18&&s<20&&m(.6);if(s>=20&&s<24){m(.8);$(".center").css("box-shadow","0 0 4px white");$(".search").css("box-shadow","0 0 4px white")}if(s>=0&&s<7){m(.9);$(".center").css("box-shadow","0 0 5px white");$(".search").css("box-shadow","0 0 5px white");$(".c").css("box-shadow"," 0 -2px 5px 2px gray");$(".f").css("box-shadow"," 0 -2px 5px 2px gray");$(".time-date").css("box-shadow"," 0 -2px 5px 2px gray")}if(s>=7&&s<12){m(.1);$(".center").css("box-shadow","none");$(".search").css("box-shadow","none")}if(s>=12&&s<16){m(.3);$(".center").css("box-shadow","none");$(".search").css("box-shadow","none")}if(s>=16&&s<18){m(.5);$(".center").css("box-shadow","0 0 2px white");$(".search").css("box-shadow","0 0 2px white");$(".active-unit").css("box-shadow"," 0 -2px 3px 3px white");console.log("Good Evening")}}});var m="<span style='font-weight:400;font-size:.5em;'> mph</span>",g="<span style='font-weight:400;font-size:.5em;'> kmh</span>",y="<span style='font-weight:400;font-size:.8em;'> mph</span>",b="<span style='font-weight:400;font-size:.8em;'> kmh</span>",w,E;if(t=="imperial"){E=m;w=y}else if(t=="metric"){E=g;w=b}var S=$(window).width(),T=$(window).height();if(S==320&&T==480){$(".wind").html("<span style='font-weight:400'>W: </span>"+u+"<span style='font-weight:400;font-size:1.9em;'>"+w+"</span>");$(".humidity").html("<span style='font-weight:400'>H: </span>"+a+"<span style='font-weight:400;font-size:.7em;'> %</span>")}else{$(".clear320").remove();$(".wind").html("<span style='font-weight:400'>Wind: </span>"+u+"<span style='font-weight:400;font-size:.7em;'>"+w+"</span>");$(".humidity").html("<span style='font-weight:400'>Humidity: </span>"+a+"<span style='font-weight:400;font-size:.7em;'> %</span>")}var N="<span style='font-weight:400;font-size:.5em;'> %</span>",C="<span style='font-weight:400;font-size:.5em;'> kPa</span>";for(i=1;i<=5;i++){$("#n"+i+"dMax").html(tempNextDayMax[i-1]);$("#n"+i+"dMin").html(tempNextDayMin[i-1]);if(tempNextDayCond[i-1].indexOf("Showers")){var k=/(\w+)\s(\w+)/gi,L=/\s\w+/gi,A;A=tempNextDayCond[i-1].replace(k,"$1 <span class='property'>$2</span>")}$("#n"+i+"dCond").html(A);$("#n"+i+"dWind").html(tempNextDayWind[i-1]+" mph");$("#n"+i+"dHumidity").html(tempNextDayHumidity[i-1]+N)}}});$(".search-text").blur()});var r="imperial",h=[];$(".save").on("click",function(){var e=[];if(localStorage.length>0){var t=JSON.parse(localStorage.getItem("cityArr")).length;ftrCount=t;console.log("localStorage ftrCount::"+ftrCount);var n=JSON.parse(localStorage.getItem("cityArr"));for(i=0;i<=n.length-1;i++)e.push(n[i]);$(".clear").on("click",function(){localStorage.clear();$(".right").children("*").remove();$(".clear").css({opacity:".4",cursor:"default"})});$(".clear320").on("click",function(){localStorage.clear();$(".right").children(".ftr").remove();$(".clear320").css({opacity:".4",cursor:"default"})})}else{$(".clear").css({opacity:".4",cursor:"default"});ftrCount=0;console.log("localStorage ftrCount::"+ftrCount)}ftrCount++;if(ftrCount===6)return!1;console.log("ftrCountsss "+ftrCount);cityText=$(".city-content").html();p(ftrCount);if(ftrCount===6)return!1;var r=parseInt($(".tempr-content").html()),s=parseInt($(".min").html()),o=$(".condition").html();e.push({city:cityText,temp:r,minx:s,minCond:o});localStorage.setItem("cityArr",JSON.stringify(e));var t=JSON.parse(localStorage.getItem("cityArr"));$("#city"+ftrCount).html(t[ftrCount-1].city);$("#tempr"+ftrCount).html(t[ftrCount-1].temp);$("#min"+ftrCount).html(t[ftrCount-1].minx);$("#minCond"+ftrCount).html(t[ftrCount-1].minCond)});d();$(".search-text").autocomplete("option","delay",150)});